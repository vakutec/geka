import{c as M,r as t,j as e,b as E}from"./index-COeZczhV.js";let h=null;function z(){return h||(h=M("https://kidgyvntrfitsjegieck.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpZGd5dm50cmZpdHNqZWdpZWNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MTc0NDYsImV4cCI6MjA3MzA5MzQ0Nn0.3zkQZYBkmEIAIr7XsKMSJu4VQd6fSekr_CSoHOOM5P8"),h)}function D(n){return new URLSearchParams(window.location.search).get(n)}function J(){const n=t.useMemo(()=>z(),[]),[a,x]=t.useState(""),[j,k]=t.useState([]),[b,f]=t.useState(""),[r,d]=t.useState(1),[y,N]=t.useState(!1),[g,_]=t.useState(null),[I,c]=t.useState(null),[v,o]=t.useState(null),[C,w]=t.useState(!1);t.useEffect(()=>{const s=D("display_id");s&&x(s)},[]),t.useEffect(()=>{(async()=>{const{data:s,error:l}=await n.from("items").select("id, name, price_cents").eq("is_active",!0).order("name");!l&&s&&k(s)})()},[n]),t.useEffect(()=>{const s=a.trim();if(!s){o(null);return}w(!0);const l=setTimeout(async()=>{const{data:u,error:m}=await n.rpc("get_balance_by_display_id",{_display_id:s});if(w(!1),m||!u||!u[0]){o(null);return}o(Number(u[0].balance_cents))},300);return()=>clearTimeout(l)},[a,n]);const i=j.find(s=>s.id===b)||null,S=i?i.price_cents*r:0,B=async()=>{c(null),_(null);const s=a.trim();if(!s){c("Bitte ID eingeben.");return}if(!i){c("Bitte Produkt wählen.");return}if(r<=0){c("Menge prüfen.");return}N(!0);const l=window.BOOK_RPC||"book_transaction",{data:u,error:m}=await n.rpc(l,{_display_id:s,_item_id:i.id,_qty:r});if(N(!1),m){c(m.message);return}_("Buchung gespeichert.");const{data:p}=await n.rpc("get_balance_by_display_id",{_display_id:s});p&&p[0]&&o(Number(p[0].balance_cents)),f(""),d(1)};return e.jsx("div",{className:"wrap",children:e.jsxs("div",{className:"card col",children:[e.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx("span",{className:"badge",children:"Kiosk"})}),e.jsxs("div",{className:"muted",children:["Gesamt: ",e.jsxs("b",{className:"price",children:[(S/100).toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"muted",children:"Dein Kürzel / ID"}),e.jsx("input",{placeholder:"z. B. TEAM1",value:a,onChange:s=>x(s.target.value)}),a.trim()&&e.jsx("div",{className:"muted",children:C?"Lade Kontostand…":v!==null?e.jsxs(e.Fragment,{children:["Kontostand: ",e.jsxs("b",{className:"price",children:[(v/100).toFixed(2)," €"]})]}):"ID nicht gefunden"})]}),e.jsxs("div",{className:"col",children:[e.jsx("label",{className:"muted",children:"Produkt"}),e.jsxs("select",{value:b,onChange:s=>f(s.target.value),children:[e.jsx("option",{value:"",children:"– bitte wählen –"}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.name," — ",(s.price_cents/100).toFixed(2)," €"]},s.id))]})]}),i&&e.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[e.jsxs("div",{className:"row",children:[e.jsx("button",{onClick:()=>d(s=>Math.max(1,s-1)),children:"−"}),e.jsx("input",{value:r,onChange:s=>d(Math.max(1,Number(s.target.value)||1)),style:{width:64,textAlign:"center"}}),e.jsx("button",{onClick:()=>d(s=>s+1),children:"+"})]}),e.jsxs("div",{className:"muted",children:["Einzelpreis: ",e.jsxs("b",{className:"price",children:[(i.price_cents/100).toFixed(2)," €"]})]})]}),e.jsx("div",{className:"row",style:{justifyContent:"flex-end"},children:e.jsx("button",{onClick:B,disabled:y||!a.trim()||!i,children:y?"Speichere…":"Buchen"})}),g&&e.jsx("div",{className:"ok",children:g}),I&&e.jsx("div",{className:"error",children:I}),e.jsx("div",{className:"muted",children:"Hinweis: Nach der Buchung wird die Produktauswahl gelöscht, die ID bleibt erhalten."})]})})}E(document.getElementById("root")).render(e.jsx(J,{}));
