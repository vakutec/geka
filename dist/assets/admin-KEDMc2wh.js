import{j as e,r,c as z,a as Z,R as F}from"./index-COeZczhV.js";function O({className:s="",style:t,...n}){return e.jsx("span",{className:s,style:{display:"inline-block",padding:"2px 8px",borderRadius:999,background:"#e2e8f0",color:"#0f172a",fontSize:12,...t},...n})}const d=r.forwardRef(({variant:s="default",className:t="",style:n,...l},c)=>{const i={borderRadius:12,padding:"10px 14px",fontSize:14,cursor:"pointer",border:"1px solid #cbd5e1",background:"#0ea5e9",color:"#fff"};return s==="outline"&&(i.background="#fff",i.color="#0f172a"),s==="secondary"&&(i.background="#e2e8f0",i.color="#0f172a"),e.jsx("button",{ref:c,className:t,style:{...i,...n},...l})});d.displayName="Button";function M({className:s="",style:t,...n}){return e.jsx("div",{className:s,style:{border:"1px solid #e2e8f0",borderRadius:16,background:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,.06)",...t},...n})}function E({className:s="",style:t,...n}){return e.jsx("div",{className:s,style:{padding:16,...t},...n})}const v=r.forwardRef(({className:s="",style:t,...n},l)=>e.jsx("input",{ref:l,className:s,style:{border:"1px solid #cbd5e1",borderRadius:12,padding:"10px 12px",fontSize:14,...t},...n}));v.displayName="Input";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,l)=>l?l.toUpperCase():n.toLowerCase()),A=s=>{const t=$(s);return t.charAt(0).toUpperCase()+t.slice(1)},L=(...s)=>s.filter((t,n,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===n).join(" ").trim(),P=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var W={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=r.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:c="",children:i,iconNode:h,...m},j)=>r.createElement("svg",{ref:j,...W,width:t,height:t,stroke:s,strokeWidth:l?Number(n)*24/Number(t):n,className:L("lucide",c),...!i&&!P(m)&&{"aria-hidden":"true"},...m},[...h.map(([x,p])=>r.createElement(x,p)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=(s,t)=>{const n=r.forwardRef(({className:l,...c},i)=>r.createElement(D,{ref:i,iconNode:t,className:L(`lucide-${J(A(s))}`,`lucide-${s}`,l),...c}));return n.displayName=A(s),n};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],V=k("check",T);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],H=k("euro",X);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],I=k("loader-circle",Q);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],q=k("lock",Y);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],B=k("log-out",G);function K(s){if(!s)return null;const t=s.trim().replace(/\s+/g,"").replace(",","."),n=Number(t);if(!Number.isFinite(n))return null;const l=Math.round(n*100);return l<=0?null:l}function U({supabase:s}){const[t,n]=r.useState(""),[l,c]=r.useState(null),[i,h]=r.useState(!1),[m,j]=r.useState("Bar"),[x,p]=r.useState(""),[b,N]=r.useState(!1),[C,f]=r.useState(null),[y,g]=r.useState(null);r.useEffect(()=>{const a=t.trim();if(!a){c(null);return}h(!0);const o=setTimeout(async()=>{const{data:u,error:_}=await s.rpc("get_balance_by_display_id",{_display_id:a});if(h(!1),_||!u||!u[0]){c(null);return}c(Number(u[0].balance_cents))},300);return()=>clearTimeout(o)},[t,s]);const w=a=>p(String(a)),S=async()=>{g(null),f(null);const a=t.trim(),o=K(String(x));if(!a){g("Bitte eine ID eingeben.");return}if(o==null){g("Betrag prüfen.");return}N(!0);const{data:u,error:_}=await s.rpc("admin_add_payment_by_display_id",{_display_id:a,_amount_cents:o,_method:m});if(N(!1),_){g(_.message);return}const R=u&&u[0]?Number(u[0].new_balance_cents):null;c(R),f("Zahlung erfasst."),p("")};return e.jsx(M,{className:"rounded-3xl shadow-sm border border-slate-200 bg-white/90 backdrop-blur",children:e.jsxs(E,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[e.jsx(H,{})," ",e.jsx("h2",{className:"font-semibold",children:"Zahlungen entgegennehmen"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{placeholder:"display_id (z. B. MAX23)",value:t,onChange:a=>n(a.target.value),className:"flex-1"}),e.jsx(d,{variant:"secondary",onClick:()=>n(""),children:"Clear"})]}),t.trim()&&e.jsx("div",{className:"text-sm",children:i?e.jsxs("span",{className:"inline-flex items-center gap-2 text-slate-500",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"})," Lade Saldo…"]}):l!==null?e.jsxs(e.Fragment,{children:["Aktueller Stand: ",e.jsxs("span",{className:"font-semibold",children:[(l/100).toFixed(2)," €"]})]}):e.jsx("span",{className:"text-slate-500",children:"ID nicht gefunden"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>w(20),children:"+20 €"}),e.jsx(d,{variant:"outline",onClick:()=>w(50),children:"+50 €"}),e.jsx(d,{variant:"outline",onClick:()=>w(100),children:"+100 €"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{placeholder:"Betrag in €",inputMode:"decimal",value:x,onChange:a=>p(a.target.value)}),e.jsxs("select",{value:m,onChange:a=>j(a.target.value),className:"rounded-xl border border-slate-300 px-3 py-2 text-sm",children:[e.jsx("option",{children:"Bar"}),e.jsx("option",{children:"Überweisung"})]}),e.jsx(d,{onClick:S,disabled:b||!t.trim(),className:"h-11",children:b?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"})," Speichern…"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Gutschreiben"]})})]}),C&&e.jsx("div",{className:"p-3 rounded-xl bg-green-50 text-green-800 border border-green-200",children:C}),y&&e.jsx("div",{className:"p-3 rounded-xl bg-red-50 text-red-800 border border-red-200",children:y})]})})}function ee(){const s=r.useMemo(()=>z("https://kidgyvntrfitsjegieck.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpZGd5dm50cmZpdHNqZWdpZWNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MTc0NDYsImV4cCI6MjA3MzA5MzQ0Nn0.3zkQZYBkmEIAIr7XsKMSJu4VQd6fSekr_CSoHOOM5P8"),[]),[t,n]=r.useState(null),[l,c]=r.useState(null),[i,h]=r.useState(null),[m,j]=r.useState(""),[x,p]=r.useState(""),[b,N]=r.useState(!1),[C,f]=r.useState(!0),[y,g]=r.useState(null);r.useEffect(()=>{s.auth.getSession().then(({data:o})=>n(o.session));const{data:a}=s.auth.onAuthStateChange((o,u)=>n(u));return()=>a==null?void 0:a.subscription.unsubscribe()},[s]),r.useEffect(()=>{(async()=>{if(f(!0),g(null),!t){c(null),f(!1);return}const{data:a,error:o}=await s.from("profiles").select("role").eq("user_id",t.user.id).maybeSingle();if(o){g(o.message),c(null),f(!1);return}c((a==null?void 0:a.role)==="admin"),f(!1)})()},[t,s]);const w=async()=>{N(!0),h(null);const{error:a}=await s.auth.signInWithPassword({email:m.trim(),password:x});N(!1),a&&h(a.message)},S=async()=>{await s.auth.signOut()};return t?C?e.jsx("div",{className:"min-h-screen p-6 flex items-center justify-center bg-slate-50 text-slate-600",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"})," prüfe Berechtigungen…"]})}):y?e.jsx("div",{className:"min-h-screen p-6 flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"text-2xl",children:"⚠️"}),e.jsx("div",{className:"font-semibold",children:"Fehler beim Berechtigungscheck"}),e.jsx("div",{className:"text-sm text-slate-600 max-w-md break-all",children:y}),e.jsx(d,{onClick:()=>location.reload(),className:"mt-2",children:"Nochmal versuchen"})]})}):l!==!0?e.jsx("div",{className:"min-h-screen p-6 flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"text-2xl",children:"🚫"}),e.jsx("div",{className:"font-semibold",children:"Kein Zugriff"}),e.jsx("div",{className:"text-sm text-slate-600",children:"Dieser Account hat keine Admin-Rechte."}),e.jsxs(d,{onClick:S,className:"mt-2",children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Abmelden"]})]})}):e.jsx("div",{className:"min-h-screen p-4 md:p-8 bg-gradient-to-b from-white to-slate-50",children:e.jsxs("div",{className:"mx-auto max-w-2xl space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{children:"Admin"}),e.jsx("span",{className:"text-sm text-slate-500",children:"angemeldet"})]}),e.jsxs(d,{variant:"outline",onClick:S,children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Logout"]})]}),e.jsx(U,{supabase:s})]})}):e.jsx("div",{className:"min-h-screen p-4 md:p-8 bg-gradient-to-b from-white to-slate-50",children:e.jsx("div",{className:"mx-auto max-w-sm",children:e.jsx(M,{className:"rounded-3xl shadow-sm border border-slate-200 bg-white/90 backdrop-blur",children:e.jsxs(E,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{})," ",e.jsx("h1",{className:"text-xl font-semibold",children:"Admin Login"})]}),e.jsx(v,{placeholder:"E-Mail",type:"email",value:m,onChange:a=>j(a.target.value)}),e.jsx(v,{placeholder:"Passwort",type:"password",value:x,onChange:a=>p(a.target.value)}),e.jsx(d,{onClick:w,disabled:b,className:"w-full h-11 text-base",children:b?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"})," Anmelden…"]}):"Anmelden"}),i&&e.jsx("div",{className:"text-sm text-red-600",children:i}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Nach dem Login starten wir im Bereich ",e.jsx("b",{children:"Zahlungen"}),". Weitere Bereiche können wir danach zuschalten."]})]})})})})}Z.createRoot(document.getElementById("root")).render(e.jsx(F.StrictMode,{children:e.jsx(ee,{})}));
